<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>mill</title>
  <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>

<h1>MILL</h1>

<p>Go-style concurrency in C</p>

<ul id='toplist'>
<li><a href="index.html">Home</a></li>
<li><a href="download.html">Download</a></li>
<li><a href="documentation.html">Documentation</a></li>
<li><a href="development.html">Development</a></li>
<li><a href="community.html">Community</a></li>
</ul>

<h2>Documentation</h2>

<h3>Build</h3>

<p>To use Mill, include mill.h and add mill.c to your project.</p>

<h3>Coroutines</h3>

<p>Any function can be executed as a coroutine:</p>

<pre>
void foo(int i, int j) {
    ...
}

int main() {
    go(foo(1, 2));
    return 0;
}
</pre>

<p>Even functions with exotic argument lists can be executed as coroutines:</p>

<pre>
go(printf("%d + %d = %d\n", 2, 2, 4));
</pre>

<p>However, keep in mind that coroutines are executed in parallel and thus
any return values will be lost.</p>

<h3>Channels</h3>

Channels are typed communication pipes. To create a channel specify what kind
of values are meant to be passed through it. The second parameter is the
buffer size:</p>

<pre>
chan ch = chmake(int, 0);
</pre>

<p>To send a value to the channel use 'chs' statement:</p>

<pre>
chs(ch, int, 42);
</pre>

<p>To receive a value from the channel use 'chr' expression:</p>

<pre>
int i = chr(ch, int);
</pre>

<p>To deallocate the channel use 'chclose' function:</p>

<pre>
chclose(ch);
</pre>

<p>When sharing a channel between two or more coroutines it is good practice
to duplicate the channel handle. Channel is deallocated only after all its
handles are closed:</p>

<pre>
void sender(chan ch) {
    chs(ch, int, 42);
    chclose(ch);
}

int main() {
    chan ch = chmake(int, 0);
    go(sender(ch));
    int i = chr(ch, int);
    assert(i == 42);
    chclose(ch);
    return 0;
}
</pre>

<h3>'choose' statement</h3>

<pre>
choose {
in(ch1, int, val):
    printf("Value %d received from ch1.\n", val);
out(ch2, int, 42):
    printf("Value 42 sent to ch2.\n");
otherwise:
    printf("Neither ch1 nor ch2 can be used at the moment.\n");
end
}
</pre>

<h3>Library</h3>

<t>Coroutine-friendly versions of POSIX blocking functions:</t>

<pre>
void msleep(unsigned int sec);
void musleep(unsigned long us);

int msocket(int family, int type, int protocol);
int mconnect(int s, const struct sockaddr *addr, socklen_t addrlen);
int maccept(int s, struct sockaddr *addr, socklen_t *addrlen);
ssize_t msend(int s, const void *buf, size_t len, int flags);
ssize_t mrecv(int s, void *buf, size_t len, int flags);
</pre>

</body>
</html>

